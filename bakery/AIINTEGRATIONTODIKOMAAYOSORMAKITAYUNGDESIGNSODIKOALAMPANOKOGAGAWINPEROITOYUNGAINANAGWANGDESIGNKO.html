<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced AI Cake Customizer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f2f7;
      color: #333;
      line-height: 1.6;
    }
    /* Modal styles */
  .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.6);
    z-index: 998;
  }
  
  .modal-content {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    width: 80%;
    max-width: 900px;
    max-height: 80vh;
    border-radius: 10px;
    z-index: 999;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    overflow: hidden;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
    background-color: #d83790;
    color: white;
  }
  
  .modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
  }
  
  .modal-header button {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .modal-body {
    padding: 20px;
    overflow-y: auto;
    max-height: calc(80vh - 60px);
  }
  
  /* FAB styles */
  #fab-container {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 99;
  }
  
  #view-saved-designs {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background-color: #d83790;
    color: white;
    border: none;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }
  
  #view-saved-designs:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.25);
  }
  
  #view-saved-designs i {
    font-size: 24px;
  }
  
  /* Saved designs display */
  #saved-designs-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 20px;
  }
  
  .saved-design-card {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  
  .saved-design-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0,0,0,0.15);
  }
  
  .saved-design-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }
  
  .saved-design-info {
    padding: 15px;
  }
  
  .saved-design-description {
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .saved-design-price {
    font-weight: bold;
    color: #d83790;
  }
  
  .saved-design-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
  }
  
  .saved-design-actions button {
    padding: 8px 12px;
    font-size: 0.85rem;
    flex: 1;
    margin: 0 5px;
  }
  
  /* Add this to the bottom of your existing CSS */
  .responsive-toolbar {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background-color: white;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    padding: 10px 0;
    z-index: 90;
  }
  
  .responsive-toolbar-buttons {
    display: flex;
    justify-content: space-around;
  }
  
  .responsive-toolbar-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #666;
    text-decoration: none;
    font-size: 0.8rem;
  }
  
  .responsive-toolbar-button i {
    font-size: 1.5rem;
    margin-bottom: 5px;
    color: #d83790;
  }
  
  @media (max-width: 768px) {
    .responsive-toolbar {
      display: block;
    }
    
    #fab-container {
      display: none;
    }
    
    .main-content {
      padding-bottom: 70px;
    }
  }
  
  /* Theme toggle style */
  .theme-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    background: #f3e5f5;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  }
  
  .theme-toggle:hover {
    background: #e1bee7;
  }
  
  /* Dark theme styles */
  body.dark-theme {
    background-color: #121212;
    color: #f1f1f1;
  }
  
  body.dark-theme header {
    background: linear-gradient(135deg, #2c0b22, #1a1a1a);
  }
  
  body.dark-theme .cake-preview,
  body.dark-theme .customization-panel {
    background-color: #1e1e1e;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
  }
  
  body.dark-theme input[type="text"], 
  body.dark-theme textarea, 
  body.dark-theme select {
    background-color: #2d2d2d;
    border-color: #444;
    color: #f1f1f1;
  }
  
  body.dark-theme .cake-detail-item,
  body.dark-theme .feature-list,
  body.dark-theme .order-summary {
    background-color: #252525;
  }
  
  body.dark-theme .suggestion-chip {
    background-color: #3d2a40;
  }
  
  body.dark-theme .suggestion-chip:hover {
    background-color: #583e5c;
  }
  
  body.dark-theme .ai-settings {
    background-color: #252525;
  }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px 0;
      background: linear-gradient(135deg, #f9d9eb, #f7f2f7);
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    h1 {
      color: #d83790;
      margin-bottom: 5px;
      font-size: 2.5rem;
      letter-spacing: 1px;
    }
    .tagline {
      color: #666;
      font-style: italic;
      font-size: 1.1rem;
    }
    .main-content {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
    }
    .cake-preview {
      flex: 1;
      min-width: 420px;
      background-color: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }
    .customization-panel {
      flex: 1;
      min-width: 420px;
      background-color: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }
    .image-container {
      width: 100%;
      height: 350px;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 20px;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .image-container:hover {
      transform: scale(1.01);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: all 0.5s ease;
    }
    .loading {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      color: #d83790;
    }
    .loading-spinner {
      border: 5px solid #f3f3f3;
      border-top: 5px solid #d83790;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .form-group {
      margin-bottom: 25px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555;
      font-size: 1.05rem;
    }
    input[type="text"], textarea, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
    }
    input[type="text"]:focus, textarea:focus, select:focus {
      border-color: #d83790;
      outline: none;
      box-shadow: 0 0 0 3px rgba(216, 55, 144, 0.2);
    }
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    button {
      background-color: #d83790;
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 6px rgba(216, 55, 144, 0.2);
    }
    button:hover {
      background-color: #c02a7a;
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(216, 55, 144, 0.3);
    }
    button:active {
      transform: translateY(0);
    }
    button i {
      margin-right: 8px;
    }
    .cake-details {
      margin-top: 25px;
      padding-top: 25px;
      border-top: 1px solid #eee;
    }
    .cake-detail-item {
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      padding: 10px;
      background-color: #fcf8fc;
      border-radius: 6px;
    }
    .cake-detail-item span:first-child {
      font-weight: bold;
      min-width: 80px;
    }
    .price {
      font-size: 28px;
      font-weight: bold;
      color: #d83790;
      text-align: right;
      margin-top: 25px;
      padding: 10px 20px;
      background-color: #fcf8fc;
      border-radius: 8px;
      display: inline-block;
      float: right;
    }
    .gallery {
      display: flex;
      gap: 15px;
      margin-top: 25px;
      overflow-x: auto;
      padding-bottom: 15px;
      scrollbar-width: thin;
      scrollbar-color: #d83790 #f7f2f7;
    }
    .gallery::-webkit-scrollbar {
      height: 8px;
    }
    .gallery::-webkit-scrollbar-thumb {
      background: #d83790;
      border-radius: 10px;
    }
    .gallery::-webkit-scrollbar-track {
      background: #f7f2f7;
      border-radius: 10px;
    }
    .gallery-item {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.3s;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      flex-shrink: 0;
    }
    .gallery-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .gallery-item.active {
      border-color: #d83790;
    }
    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .gallery-item:hover img {
      transform: scale(1.05);
    }
    .feature-list {
      margin-top: 15px;
      padding: 15px;
      background-color: #fcf8fc;
      border-radius: 8px;
      font-size: 0.95rem;
    }
    .feature-list h3 {
      color: #d83790;
      margin-top: 0;
    }
    .feature-list ul {
      padding-left: 20px;
      margin-bottom: 0;
    }
    .feature-list li {
      margin-bottom: 5px;
    }
    .prompt-suggestions {
      margin-top: 10px;
    }
    .suggestion-chip {
      display: inline-block;
      padding: 6px 12px;
      margin: 5px;
      background-color: #f3e5f5;
      border-radius: 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .suggestion-chip:hover {
      background-color: #e1bee7;
      transform: translateY(-2px);
    }
    .ai-settings {
      margin-top: 15px;
      padding: 15px;
      background-color: #f8f8f8;
      border-radius: 8px;
    }
    .ai-setting-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .ai-setting-row label {
      margin-bottom: 0;
      flex: 1;
    }
    .ai-setting-row input[type="range"] {
      flex: 2;
      margin: 0 10px;
    }
    .ai-setting-row span {
      width: 40px;
      text-align: center;
    }
    .section-title {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      color: #d83790;
    }
    .section-title i {
      margin-right: 10px;
    }
    .order-summary {
      margin-top: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-radius: 8px;
      border-left: 4px solid #d83790;
    }
    .btn-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    .btn-group button {
      flex: 1;
    }
    #order-btn {
      background-color: #28a745;
    }
    #order-btn:hover {
      background-color: #218838;
    }
    .toppings-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 10px;
    }
    .topping-option {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .topping-option:hover {
      background-color: #f3e5f5;
    }
    .topping-option.selected {
      background-color: #e1bee7;
      border-color: #d83790;
    }
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
      margin-left: 5px;
    }
    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: #555;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.85rem;
      font-weight: normal;
    }
    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }
    @media (max-width: 768px) {
      .toppings-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Dream Cake Customizer</h1>
      <p class="tagline">Describe your perfect cake and our AI will bring it to life!</p>
      <button class="theme-toggle" id="theme-toggle">
        <i class="fas fa-moon"></i>
      </button>
    </header>
    
    <div class="main-content">
      <div class="cake-preview">
        <div class="section-title">
          <i class="fas fa-birthday-cake"></i>
          <h2>Your Cake Preview</h2>
        </div>
        <div class="image-container">
          <img id="cake-image" src="/api/placeholder/400/300?text=Your+Dream+Cake" alt="Your custom cake preview">
          <div id="loading" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            <div id="loading-text">Generating your cake...</div>
          </div>
        </div>
        <div class="gallery" id="gallery">
          <!-- Gallery will be populated by JavaScript -->
        </div>
        <div class="cake-details">
          <div class="cake-detail-item"><span>Flavor:</span> <span id="detail-flavor">Vanilla</span></div>
          <div class="cake-detail-item"><span>Size:</span> <span id="detail-size">8 inch (serves 10-12)</span></div>
          <div class="cake-detail-item"><span>Style:</span> <span id="detail-style">Traditional</span></div>
          <div class="cake-detail-item"><span>Toppings:</span> <span id="detail-toppings">None</span></div>
          <div class="price">$45.00</div>
          <div style="clear: both;"></div>
        </div>

        <div class="order-summary">
          <h3>Your Custom Cake</h3>
          <p id="summary-description">Your cake description will appear here after generation.</p>
        </div>
      </div>
      
      <div class="customization-panel">
        <div class="section-title">
          <i class="fas fa-magic"></i>
          <h2>Customize Your Cake</h2>
        </div>
        <div class="form-group">
          <label for="cake-prompt">Describe your dream cake:</label>
          <textarea id="cake-prompt" placeholder="Example: A two-tier beach themed cake with seashells and blue waves, perfect for a summer birthday"></textarea>
          <div class="prompt-suggestions">
            <div class="suggestion-chip" data-prompt="A three-tiered wedding cake with white fondant and delicate sugar flowers">Wedding Cake</div>
            <div class="suggestion-chip" data-prompt="A chocolate birthday cake with rainbow sprinkles and custom name on top">Birthday Cake</div>
            <div class="suggestion-chip" data-prompt="An elegant anniversary cake with gold accents and red roses">Anniversary Cake</div>
            <div class="suggestion-chip" data-prompt="A whimsical unicorn cake with pastel colors and a golden horn">Unicorn Cake</div>
          </div>
        </div>
        
        <div class="ai-settings">
          <h3>AI Image Settings</h3>
          <div class="ai-setting-row">
            <label for="creativity-level">Creativity Level:</label>
            <input type="range" id="creativity-level" min="1" max="10" value="7">
            <span id="creativity-value">7</span>
          </div>
          <div class="ai-setting-row">
            <label for="detail-level">Detail Level:</label>
            <input type="range" id="detail-level" min="1" max="10" value="8">
            <span id="detail-value">8</span>
          </div>
        </div>
        
        <button id="generate-btn"><i class="fas fa-wand-magic-sparkles"></i> Generate Cake Image</button>
        
        <div class="form-group" style="margin-top: 25px;">
          <label for="cake-flavor">
            Cake Flavor:
            <span class="tooltip"><i class="fas fa-question-circle"></i>
              <span class="tooltiptext">Choose from our signature flavors baked fresh daily</span>
            </span>
          </label>
          <select id="cake-flavor">
            <option value="vanilla">Vanilla</option>
            <option value="chocolate">Chocolate</option>
            <option value="red-velvet">Red Velvet</option>
            <option value="carrot">Carrot</option>
            <option value="lemon">Lemon</option>
            <option value="marble">Marble</option>
            <option value="strawberry">Strawberry</option>
            <option value="coconut">Coconut</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="cake-size">Cake Size:</label>
          <select id="cake-size">
            <option value="4inch">4 inch (serves 4-6) - $25.00</option>
            <option value="6inch">6 inch (serves 8-10) - $35.00</option>
            <option value="8inch" selected>8 inch (serves 10-12) - $45.00</option>
            <option value="10inch">10 inch (serves 15-20) - $60.00</option>
            <option value="12inch">12 inch (serves 25-30) - $75.00</option>
            <option value="tiered">Two-tier (serves 40-50) - $120.00</option>
            <option value="3tiered">Three-tier (serves 75-100) - $220.00</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="cake-style">Cake Style:</label>
          <select id="cake-style">
            <option value="traditional">Traditional</option>
            <option value="modern">Modern</option>
            <option value="rustic">Rustic</option>
            <option value="elegant">Elegant</option>
            <option value="whimsical">Whimsical</option>
            <option value="minimalist">Minimalist</option>
            <option value="artistic">Artistic</option>
          </select>
        </div>

        <div class="form-group">
          <label>Toppings & Decorations:</label>
          <div class="toppings-grid" id="toppings-grid">
            <div class="topping-option" data-topping="sprinkles">Sprinkles</div>
            <div class="topping-option" data-topping="fruits">Fresh Fruits</div>
            <div class="topping-option" data-topping="chocolate">Chocolate Shavings</div>
            <div class="topping-option" data-topping="flowers">Sugar Flowers</div>
            <div class="topping-option" data-topping="macarons">Macarons</div>
            <div class="topping-option" data-topping="toppers">Custom Toppers</div>
          </div>
        </div>
        
        <div class="feature-list">
          <h3>Why Choose Our AI Cake Designer?</h3>
          <ul>
            <li>Visualize your cake before ordering</li>
            <li>Try multiple designs with no commitment</li>
            <li>Share designs with friends and family</li>
            <li>Save your favorite designs for later</li>
          </ul>
        </div>
        
        <div class="btn-group">
          <button id="save-btn"><i class="far fa-heart"></i> Save Design</button>
          <button id="order-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</button>
        </div>
      </div>
    </div>
    <div class="responsive-toolbar">
        <div class="responsive-toolbar-buttons">
          <a href="#" class="responsive-toolbar-button" id="toolbar-customize">
            <i class="fas fa-sliders-h"></i>
            <span>Customize</span>
          </a>
          <a href="#" class="responsive-toolbar-button" id="toolbar-generate">
            <i class="fas fa-wand-magic-sparkles"></i>
            <span>Generate</span>
          </a>
          <a href="#" class="responsive-toolbar-button" id="toolbar-saved">
            <i class="fas fa-heart"></i>
            <span>Saved</span>
          </a>
          <a href="#" class="responsive-toolbar-button" id="toolbar-cart">
            <i class="fas fa-shopping-cart"></i>
            <span>Cart</span>
          </a>
        </div>
      </div>
  </div>

  <div id="saved-designs-modal" style="display:none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2>My Saved Designs</h2>
        <button id="close-saved-designs">&times;</button>
      </div>
      <div class="modal-body">
        <div id="saved-designs-container">
          <!-- Saved designs will be dynamically populated here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add a floating action button -->
  <div id="fab-container">
    <button id="view-saved-designs" title="View Saved Designs">
      <i class="fas fa-heart"></i>
    </button>
  </div>

  <script>
    // Enhanced AI cake image generation (simulation)
    const cakeVariations = [
      {
        type: "wedding",
        keywords: ["wedding", "bride", "groom", "tier", "elegant", "white", "formal"],
        images: [
          "/api/placeholder/400/300?text=Elegant+Wedding+Cake",
          "/api/placeholder/400/300?text=White+Tiered+Wedding+Cake",
          "/api/placeholder/400/300?text=Modern+Wedding+Cake"
        ]
      },
      {
        type: "birthday",
        keywords: ["birthday", "happy", "celebration", "party", "sprinkles", "candle"],
        images: [
          "/api/placeholder/400/300?text=Colorful+Birthday+Cake",
          "/api/placeholder/400/300?text=Chocolate+Birthday+Cake",
          "/api/placeholder/400/300?text=Festive+Birthday+Cake"
        ]
      },
      {
        type: "chocolate",
        keywords: ["chocolate", "cocoa", "ganache", "truffle", "fudge", "dark"],
        images: [
          "/api/placeholder/400/300?text=Rich+Chocolate+Cake",
          "/api/placeholder/400/300?text=Triple+Chocolate+Layer+Cake",
          "/api/placeholder/400/300?text=Chocolate+Ganache+Cake"
        ]
      },
      {
        type: "fruit",
        keywords: ["fruit", "berry", "strawberry", "blueberry", "raspberry", "fresh"],
        images: [
          "/api/placeholder/400/300?text=Fresh+Fruit+Cake",
          "/api/placeholder/400/300?text=Berry+Delight+Cake",
          "/api/placeholder/400/300?text=Summer+Fruit+Cake"
        ]
      },
      {
        type: "floral",
        keywords: ["flower", "floral", "rose", "garden", "spring", "bloom", "botanical"],
        images: [
          "/api/placeholder/400/300?text=Floral+Decorated+Cake",
          "/api/placeholder/400/300?text=Rose+Cake",
          "/api/placeholder/400/300?text=Spring+Blossoms+Cake"
        ]
      },
      {
        type: "kids",
        keywords: ["kid", "children", "cartoon", "character", "fun", "colorful", "unicorn", "rainbow"],
        images: [
          "/api/placeholder/400/300?text=Unicorn+Fantasy+Cake",
          "/api/placeholder/400/300?text=Rainbow+Kids+Cake",
          "/api/placeholder/400/300?text=Character+Theme+Cake"
        ]
      }
    ];
    
    // Price mapping
    const priceMap = {
      "4inch": "$25.00",
      "6inch": "$35.00",
      "8inch": "$45.00",
      "10inch": "$60.00",
      "12inch": "$75.00",
      "tiered": "$120.00",
      "3tiered": "$220.00"
    };
    
    // References to DOM elements
    const cakePrompt = document.getElementById('cake-prompt');
    const generateBtn = document.getElementById('generate-btn');
    const cakeImage = document.getElementById('cake-image');
    const loading = document.getElementById('loading');
    const loadingText = document.getElementById('loading-text');
    const gallery = document.getElementById('gallery');
    const cakeFlavor = document.getElementById('cake-flavor');
    const cakeSize = document.getElementById('cake-size');
    const cakeStyle = document.getElementById('cake-style');
    const detailFlavor = document.getElementById('detail-flavor');
    const detailSize = document.getElementById('detail-size');
    const detailStyle = document.getElementById('detail-style');
    const detailToppings = document.getElementById('detail-toppings');
    const priceElement = document.querySelector('.price');
    const orderBtn = document.getElementById('order-btn');
    const saveBtn = document.getElementById('save-btn');
    const creativityLevel = document.getElementById('creativity-level');
    const creativityValue = document.getElementById('creativity-value');
    const detailLevel = document.getElementById('detail-level');
    const detailValue = document.getElementById('detail-value');
    const summaryDescription = document.getElementById('summary-description');
    const toppingsGrid = document.getElementById('toppings-grid');
    const suggestionChips = document.querySelectorAll('.suggestion-chip');
    
    // Initialize saved designs array
    let savedDesigns = [];
    let selectedToppings = [];
    let currentDesignId = null;
    
    // Enhanced AI image generation with prompt analysis
    function generateCakeImage() {
      const promptText = cakePrompt.value.trim();
      
      if (!promptText) {
        alert('Please describe your cake first!');
        return;
      }
      
      loading.style.display = 'flex';
      loadingText.textContent = 'Analyzing your cake description...';
      
      // First phase - analyzing prompt
      setTimeout(() => {
        loadingText.textContent = 'Determining cake style...';
        
        setTimeout(() => {
          loadingText.textContent = 'Generating your cake image...';
          
          setTimeout(() => {
            // Analyze the prompt to find the best matching cake type
            const promptLower = promptText.toLowerCase();
            
            // Find the cake variation that best matches the prompt
            let bestMatch = null;
            let highestScore = -1;
            
            cakeVariations.forEach(variation => {
              let score = 0;
              variation.keywords.forEach(keyword => {
                if (promptLower.includes(keyword.toLowerCase())) {
                  score++;
                }
              });
              
              if (score > highestScore) {
                highestScore = score;
                bestMatch = variation;
              }
            });
            
            // If no good match, use a random one
            if (highestScore === 0) {
              bestMatch = cakeVariations[Math.floor(Math.random() * cakeVariations.length)];
            }
            
            // Apply detail level - higher detail means more specific image selection
            const detail = parseInt(detailLevel.value);
            
            // Select an image from the matched type
            const creativity = parseInt(creativityLevel.value);
            // Higher creativity means more randomness in selection
            let imageIndex;
            if (creativity < 5) {
              imageIndex = 0; // Most conservative/standard option
            } else if (creativity < 8) {
              imageIndex = 1; // Middle option
            } else {
              imageIndex = 2; // Most creative option
            }
            
            const generatedImageUrl = bestMatch.images[imageIndex];
            
            // Update the main cake image
            cakeImage.src = generatedImageUrl;
            
            // Update the summary description
            summaryDescription.textContent = promptText;
            
            // Add to gallery if not already present
            addToGallery(generatedImageUrl);
            
            // Generate unique ID for this design
            currentDesignId = new Date().getTime().toString();
            
            loading.style.display = 'none';
          }, 1000);
        }, 800);
      }, 800);
    }
    
    function addToGallery(imageUrl) {
      const galleryExists = Array.from(gallery.children).some(item => 
        item.querySelector('img').src === imageUrl
      );
      
      if (!galleryExists && gallery.children.length < 5) {
        const galleryItem = document.createElement('div');
        galleryItem.className = 'gallery-item';
        galleryItem.innerHTML = `<img src="${imageUrl}" alt="Cake design">`;
        galleryItem.addEventListener('click', () => {
          cakeImage.src = imageUrl;
          // Remove active class from all gallery items
          document.querySelectorAll('.gallery-item').forEach(item => {
            item.classList.remove('active');
          });
          // Add active class to this item
          galleryItem.classList.add('active');
        });
        gallery.appendChild(galleryItem);
        
        // Make the newly added item active
        document.querySelectorAll('.gallery-item').forEach(item => {
          item.classList.remove('active');
        });
        galleryItem.classList.add('active');
      }
    }
    
    // Update cake details and price
    function updateCakeDetails() {
      detailFlavor.textContent = cakeFlavor.options[cakeFlavor.selectedIndex].text;
      detailSize.textContent = cakeSize.options[cakeSize.selectedIndex].text.split('-')[0].trim();
      detailStyle.textContent = cakeStyle.options[cakeStyle.selectedIndex].text;
      
      // Update price
      const sizeValue = cakeSize.value;
      priceElement.textContent = priceMap[sizeValue];
      
      // Update toppings
      if (selectedToppings.length === 0) {
        detailToppings.textContent = "None";
      } else {
        detailToppings.textContent = selectedToppings.join(', ');
      }
    }
    
    // Handle toppings selection
    function initializeToppings() {
      const toppingOptions = document.querySelectorAll('.topping-option');
      toppingOptions.forEach(option => {
        option.addEventListener('click', () => {
          const topping = option.getAttribute('data-topping');
          
          if (option.classList.contains('selected')) {
            // Remove from selected toppings
            option.classList.remove('selected');
            selectedToppings = selectedToppings.filter(t => t !== topping);
          } else {
            // Add to selected toppings
            option.classList.add('selected');
            selectedToppings.push(topping);
          }
          
          updateCakeDetails();
        });
      });
    }
    
    // Initialize suggestion chips
    function initializeSuggestionChips() {
      suggestionChips.forEach(chip => {
        chip.addEventListener('click', () => {
          cakePrompt.value = chip.getAttribute('data-prompt');
        });
      });
    }
    
    // Save current design
    function saveCurrentDesign() {
      if (cakeImage.src === "/api/placeholder/400/300?text=Your+Dream+Cake") {
        alert("Please generate a cake design first!");
        return;
      }
      
      const design = {
        id: currentDesignId || new Date().getTime().toString(),
        image: cakeImage.src,
        description: cakePrompt.value,
        flavor: cakeFlavor.value,
        size: cakeSize.value,
        style: cakeStyle.value,
        toppings: [...selectedToppings],
        price: priceElement.textContent
      };
      
      // Check if design already exists (by image URL)
      const existingIndex = savedDesigns.findIndex(d => d.image === design.image);
      if (existingIndex !== -1) {
        // Update existing design
        savedDesigns[existingIndex] = design;
        showNotification("Design updated in your favorites!");
      } else {
        // Add new design
        savedDesigns.push(design);
        showNotification("Design saved to your favorites!");
      }
      
      // Save to localStorage
      localStorage.setItem('savedCakeDesigns', JSON.stringify(savedDesigns));
    }
    
    // Show notification
    function showNotification(message) {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      notification.style.position = 'fixed';
      notification.style.bottom = '20px';
      notification.style.right = '20px';
      notification.style.backgroundColor = '#d83790';
      notification.style.color = 'white';
      notification.style.padding = '10px 20px';
      notification.style.borderRadius = '5px';
      notification.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
      notification.style.zIndex = '1000';
      notification.style.opacity = '0';
      notification.style.transition = 'opacity 0.3s';
      
      // Add to body
      document.body.appendChild(notification);
      
      // Fade in
      setTimeout(() => {
        notification.style.opacity = '1';
      }, 10);
      
      // Fade out and remove
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // Process order
    function processOrder() {
      if (cakeImage.src === "/api/placeholder/400/300?text=Your+Dream+Cake") {
        alert("Please generate a cake design first!");
        return;
      }
      
      // Save current design
      saveCurrentDesign();
      
      // Show order confirmation
      const orderConfirmation = document.createElement('div');
      orderConfirmation.className = 'order-confirmation';
      orderConfirmation.style.position = 'fixed';
      orderConfirmation.style.top = '50%';
      orderConfirmation.style.left = '50%';
      orderConfirmation.style.transform = 'translate(-50%, -50%)';
      orderConfirmation.style.backgroundColor = 'white';
      orderConfirmation.style.padding = '30px';
      orderConfirmation.style.borderRadius = '10px';
      orderConfirmation.style.boxShadow = '0 5px 25px rgba(0,0,0,0.3)';
      orderConfirmation.style.zIndex = '1000';
      orderConfirmation.style.maxWidth = '500px';
      orderConfirmation.style.width = '90%';
      
      const orderDetails = `
        <h2 style="color: #d83790; margin-top: 0;">Order Confirmation</h2>
        <p>Your custom cake has been added to your cart!</p>
        <div style="display: flex; margin: 20px 0;">
          <img src="${cakeImage.src}" alt="Your cake" style="width: 150px; height: 150px; object-fit: cover; border-radius: 5px; margin-right: 20px;">
          <div>
            <p><strong>Description:</strong> ${cakePrompt.value}</p>
            <p><strong>Flavor:</strong> ${detailFlavor.textContent}</p>
            <p><strong>Size:</strong> ${detailSize.textContent}</p>
            <p><strong>Style:</strong> ${detailStyle.textContent}</p>
            <p><strong>Toppings:</strong> ${detailToppings.textContent}</p>
            <p><strong>Price:</strong> ${priceElement.textContent}</p>
          </div>
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
          <button id="continue-shopping" style="background-color: #666; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Continue Shopping</button>
          <button id="checkout" style="background-color: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Proceed to Checkout</button>
        </div>
      `;
      
      orderConfirmation.innerHTML = orderDetails;
      
      // Add overlay
      const overlay = document.createElement('div');
      overlay.style.position = 'fixed';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.backgroundColor = 'rgba(0,0,0,0.5)';
      overlay.style.zIndex = '999';
      
      document.body.appendChild(overlay);
      document.body.appendChild(orderConfirmation);
      
      // Add event listeners
      document.getElementById('continue-shopping').addEventListener('click', () => {
        document.body.removeChild(overlay);
        document.body.removeChild(orderConfirmation);
      });
      
      document.getElementById('checkout').addEventListener('click', () => {
        document.body.removeChild(overlay);
        document.body.removeChild(orderConfirmation);
        
        // Redirect to checkout page (simulation)
        alert("Redirecting to checkout... This is a simulation, so we'll stay on this page.");
      });
    }
    
    // Load saved designs from localStorage
    function loadSavedDesigns() {
      const savedDesignsJSON = localStorage.getItem('savedCakeDesigns');
      if (savedDesignsJSON) {
        savedDesigns = JSON.parse(savedDesignsJSON);
      }
    }
    
    // Update range input display values
    creativityLevel.addEventListener('input', () => {
      creativityValue.textContent = creativityLevel.value;
    });
    
    detailLevel.addEventListener('input', () => {
      detailValue.textContent = detailLevel.value;
    });
    
    // Add event listeners
    generateBtn.addEventListener('click', generateCakeImage);
    
    cakeFlavor.addEventListener('change', updateCakeDetails);
    cakeSize.addEventListener('change', updateCakeDetails);
    cakeStyle.addEventListener('change', updateCakeDetails);
    
    saveBtn.addEventListener('click', saveCurrentDesign);
    orderBtn.addEventListener('click', processOrder);
    
    // Initialize the app
    function initApp() {
      // Load saved designs
      loadSavedDesigns();
      
      // Initialize toppings
      initializeToppings();
      
      // Initialize suggestion chips
      initializeSuggestionChips();
      
      // Set initial cake details
      updateCakeDetails();
      
      // Enable keyboard shortcut for generation (Ctrl+Enter)
      cakePrompt.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'Enter') {
          generateCakeImage();
        }
      });
    }
    
    // Initialize the app when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', initApp);
    
    // Elements for saved designs modal
    const savedDesignsModal = document.getElementById('saved-designs-modal');
    const closeSavedDesignsBtn = document.getElementById('close-saved-designs');
    const viewSavedDesignsBtn = document.getElementById('view-saved-designs');
    const savedDesignsContainer = document.getElementById('saved-designs-container');
    // Elements for responsive toolbar
    const toolbarCustomizeBtn = document.getElementById('toolbar-customize');
    const toolbarGenerateBtn = document.getElementById('toolbar-generate');
    const toolbarSavedBtn = document.getElementById('toolbar-saved');
    const toolbarCartBtn = document.getElementById('toolbar-cart');
    // Element for theme toggle
    const themeToggleBtn = document.getElementById('theme-toggle');
    // Show saved designs modal
    function showSavedDesigns() {
      if (savedDesigns.length === 0) {
        savedDesignsContainer.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-heart-broken" style="font-size: 48px; color: #d83790; margin-bottom: 20px;"></i><p>You don\'t have any saved designs yet.</p><p>Create a design and click "Save Design" to add it to your favorites.</p></div>';
      } else {
        renderSavedDesigns();
      }
      
      savedDesignsModal.style.display = 'block';
      document.body.style.overflow = 'hidden'; // Prevent scrolling behind modal
    }
    // Hide saved designs modal
    function hideSavedDesigns() {
      savedDesignsModal.style.display = 'none';
      document.body.style.overflow = 'auto'; // Enable scrolling again
    }
    
    // Render saved designs in the modal
    function renderSavedDesigns() {
      savedDesignsContainer.innerHTML = '';
      
      savedDesigns.forEach((design, index) => {
        const designCard = document.createElement('div');
        designCard.className = 'saved-design-card';
        
        const thumbnail = document.createElement('div');
        thumbnail.className = 'saved-design-thumbnail';
        thumbnail.style.backgroundColor = design.background;
        
        // Add design elements to thumbnail preview
        if (design.elements) {
          design.elements.forEach(element => {
            const previewElement = document.createElement('div');
            previewElement.className = 'preview-element';
            previewElement.style.width = '30px';
            previewElement.style.height = '30px';
            previewElement.style.backgroundColor = element.color || '#ccc';
            thumbnail.appendChild(previewElement);
          });
        }
        
        const designInfo = document.createElement('div');
        designInfo.className = 'saved-design-info';
        
        const designTitle = document.createElement('h4');
        designTitle.textContent = design.name || `Design ${index + 1}`;
        
        const designDate = document.createElement('p');
        designDate.className = 'design-date';
        designDate.textContent = design.dateCreated || 'No date';
        
        const designActions = document.createElement('div');
        designActions.className = 'design-actions';
        
        const loadBtn = document.createElement('button');
        loadBtn.className = 'btn btn-sm btn-primary';
        loadBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
        loadBtn.addEventListener('click', () => loadSavedDesign(index));
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'btn btn-sm btn-danger';
        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
        deleteBtn.addEventListener('click', () => deleteSavedDesign(index));
        
        designActions.appendChild(loadBtn);
        designActions.appendChild(deleteBtn);
        designInfo.appendChild(designTitle);
        designInfo.appendChild(designDate);
        designInfo.appendChild(designActions);
        
        designCard.appendChild(thumbnail);
        designCard.appendChild(designInfo);
        savedDesignsContainer.appendChild(designCard);
      });
    }
    
    // Load a saved design
    function loadSavedDesign(index) {
      const design = savedDesigns[index];
      
      // Clear current design
      clearCanvas();
      
      // Load background
      if (design.background) {
        updateBackground(design.background);
      }
      
      // Load elements
      if (design.elements) {
        design.elements.forEach(element => {
          addElement(element);
        });
      }
      
      // Close modal
      hideSavedDesigns();
      
      // Show success message
      showNotification('Design loaded successfully', 'success');
    }
    
    // Delete a saved design
    function deleteSavedDesign(index) {
      if (confirm('Are you sure you want to delete this design?')) {
        savedDesigns.splice(index, 1);
        saveToLocalStorage();
        renderSavedDesigns();
        showNotification('Design deleted successfully', 'success');
        
        // Show empty state if no designs left
        if (savedDesigns.length === 0) {
          savedDesignsContainer.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-heart-broken" style="font-size: 48px; color: #d83790; margin-bottom: 20px;"></i><p>You don\'t have any saved designs yet.</p><p>Create a design and click "Save Design" to add it to your favorites.</p></div>';
        }
      }
    }
    
    // Theme toggle functionality
    function toggleTheme() {
      const currentTheme = document.body.classList.contains('dark-theme') ? 'dark' : 'light';
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      if (newTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('designToolTheme', 'dark');
      } else {
        document.body.classList.remove('dark-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('designToolTheme', 'light');
      }
      
      // Update canvas background to match theme if using default
      if (currentBackground === 'default') {
        updateBackground(newTheme === 'dark' ? '#2a2a2a' : '#ffffff');
      }
    }
    
    // Apply saved theme on load
    function applySavedTheme() {
      const savedTheme = localStorage.getItem('designToolTheme') || 'light';
      
      if (savedTheme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        document.body.classList.remove('dark-theme');
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i>';
      }
    }
    
    // Responsive toolbar functionality
    function initResponsiveToolbar() {
      toolbarCustomizeBtn.addEventListener('click', () => {
        showPanel('customize-panel');
        highlightToolbarButton(toolbarCustomizeBtn);
      });
      
      toolbarGenerateBtn.addEventListener('click', () => {
        showPanel('generate-panel');
        highlightToolbarButton(toolbarGenerateBtn);
      });
      
      toolbarSavedBtn.addEventListener('click', () => {
        showSavedDesigns();
        highlightToolbarButton(toolbarSavedBtn);
      });
      
      toolbarCartBtn.addEventListener('click', () => {
        showPanel('cart-panel');
        highlightToolbarButton(toolbarCartBtn);
      });
    }
    
    // Highlight active toolbar button
    function highlightToolbarButton(button) {
      // Remove highlight from all buttons
      const toolbarButtons = document.querySelectorAll('.toolbar-button');
      toolbarButtons.forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Add highlight to selected button
      button.classList.add('active');
    }
    
    // Show specific panel and hide others
    function showPanel(panelId) {
      const panels = document.querySelectorAll('.panel');
      panels.forEach(panel => {
        panel.style.display = 'none';
      });
      
      const selectedPanel = document.getElementById(panelId);
      if (selectedPanel) {
        selectedPanel.style.display = 'block';
      }
    }
    
    // Save designs to local storage
    function saveToLocalStorage() {
      localStorage.setItem('savedDesigns', JSON.stringify(savedDesigns));
    }
    
    // Load designs from local storage
    function loadFromLocalStorage() {
      const stored = localStorage.getItem('savedDesigns');
      if (stored) {
        savedDesigns = JSON.parse(stored);
      }
    }
    
    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <div class="notification-icon">
          <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
        </div>
        <div class="notification-message">${message}</div>
      `;
      
      document.body.appendChild(notification);
      
      // Show notification with animation
      setTimeout(() => {
        notification.classList.add('show');
      }, 10);
      
      // Auto hide after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize saved designs
      loadFromLocalStorage();
      
      // Apply saved theme
      applySavedTheme();
      
      // Initialize responsive toolbar
      initResponsiveToolbar();
      
      // Event listeners for saved designs modal
      viewSavedDesignsBtn.addEventListener('click', showSavedDesigns);
      closeSavedDesignsBtn.addEventListener('click', hideSavedDesigns);
      
      // Event listener for theme toggle
      themeToggleBtn.addEventListener('click', toggleTheme);
      
      // Close modal when clicking outside
      window.addEventListener('click', (event) => {
        if (event.target === savedDesignsModal) {
          hideSavedDesigns();
        }
      });
    });
</script>

</body>
</html>